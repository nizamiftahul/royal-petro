{"version":3,"sources":["../../src/TouchBackendImpl.ts"],"sourcesContent":["import { invariant } from '@react-dnd/invariant'\nimport type {\n\tDragDropActions,\n\tDragDropMonitor,\n\tBackend,\n\tIdentifier,\n\tXYCoord,\n\tDragDropManager,\n\tUnsubscribe,\n} from 'dnd-core'\nimport {\n\tEventName,\n\tListenerType,\n\tTouchBackendOptions,\n\tTouchBackendContext,\n} from './interfaces.js'\nimport {\n\teventShouldStartDrag,\n\teventShouldEndDrag,\n\tisTouchEvent,\n} from './utils/predicates.js'\nimport { getEventClientOffset, getNodeClientOffset } from './utils/offsets.js'\nimport { distance, inAngleRanges } from './utils/math.js'\nimport { supportsPassive } from './utils/supportsPassive.js'\nimport { OptionsReader } from './OptionsReader.js'\n\nconst eventNames: Record<ListenerType, EventName> = {\n\t[ListenerType.mouse]: {\n\t\tstart: 'mousedown',\n\t\tmove: 'mousemove',\n\t\tend: 'mouseup',\n\t\tcontextmenu: 'contextmenu',\n\t},\n\t[ListenerType.touch]: {\n\t\tstart: 'touchstart',\n\t\tmove: 'touchmove',\n\t\tend: 'touchend',\n\t},\n\t[ListenerType.keyboard]: {\n\t\tkeydown: 'keydown',\n\t},\n}\n\nexport class TouchBackendImpl implements Backend {\n\tprivate options: OptionsReader\n\n\t// React-DnD Dependencies\n\tprivate actions: DragDropActions\n\tprivate monitor: DragDropMonitor\n\n\t// Internal State\n\tprivate static isSetUp: boolean\n\tpublic sourceNodes: Map<Identifier, HTMLElement>\n\tpublic sourcePreviewNodes: Map<string, HTMLElement>\n\tpublic sourcePreviewNodeOptions: Map<string, any>\n\tpublic targetNodes: Map<string, HTMLElement>\n\tprivate _mouseClientOffset: Partial<XYCoord>\n\tprivate _isScrolling: boolean\n\tprivate listenerTypes: ListenerType[]\n\tprivate moveStartSourceIds: string[] | undefined\n\tprivate waitingForDelay: boolean | undefined\n\tprivate timeout: ReturnType<typeof setTimeout> | undefined\n\tprivate dragOverTargetIds: string[] | undefined\n\tprivate draggedSourceNode: HTMLElement | undefined\n\tprivate draggedSourceNodeRemovalObserver: MutationObserver | undefined\n\n\t// Patch for iOS 13, discussion over #1585\n\tprivate lastTargetTouchFallback: Touch | undefined\n\n\tpublic constructor(\n\t\tmanager: DragDropManager,\n\t\tcontext: TouchBackendContext,\n\t\toptions: Partial<TouchBackendOptions>,\n\t) {\n\t\tthis.options = new OptionsReader(options, context)\n\t\tthis.actions = manager.getActions()\n\t\tthis.monitor = manager.getMonitor()\n\n\t\tthis.sourceNodes = new Map()\n\t\tthis.sourcePreviewNodes = new Map()\n\t\tthis.sourcePreviewNodeOptions = new Map()\n\t\tthis.targetNodes = new Map()\n\t\tthis.listenerTypes = []\n\t\tthis._mouseClientOffset = {}\n\t\tthis._isScrolling = false\n\n\t\tif (this.options.enableMouseEvents) {\n\t\t\tthis.listenerTypes.push(ListenerType.mouse)\n\t\t}\n\n\t\tif (this.options.enableTouchEvents) {\n\t\t\tthis.listenerTypes.push(ListenerType.touch)\n\t\t}\n\n\t\tif (this.options.enableKeyboardEvents) {\n\t\t\tthis.listenerTypes.push(ListenerType.keyboard)\n\t\t}\n\t}\n\n\t/**\n\t * Generate profiling statistics for the HTML5Backend.\n\t */\n\tpublic profile(): Record<string, number> {\n\t\treturn {\n\t\t\tsourceNodes: this.sourceNodes.size,\n\t\t\tsourcePreviewNodes: this.sourcePreviewNodes.size,\n\t\t\tsourcePreviewNodeOptions: this.sourcePreviewNodeOptions.size,\n\t\t\ttargetNodes: this.targetNodes.size,\n\t\t\tdragOverTargetIds: this.dragOverTargetIds?.length || 0,\n\t\t}\n\t}\n\n\t// public for test\n\tpublic get document(): Document | undefined {\n\t\treturn this.options.document\n\t}\n\n\tpublic setup(): void {\n\t\tconst root = this.options.rootElement\n\t\tif (!root) {\n\t\t\treturn\n\t\t}\n\n\t\tinvariant(\n\t\t\t!TouchBackendImpl.isSetUp,\n\t\t\t'Cannot have two Touch backends at the same time.',\n\t\t)\n\t\tTouchBackendImpl.isSetUp = true\n\n\t\tthis.addEventListener(root, 'start', this.getTopMoveStartHandler() as any)\n\t\tthis.addEventListener(\n\t\t\troot,\n\t\t\t'start',\n\t\t\tthis.handleTopMoveStartCapture as any,\n\t\t\ttrue,\n\t\t)\n\t\tthis.addEventListener(root, 'move', this.handleTopMove as any)\n\t\tthis.addEventListener(root, 'move', this.handleTopMoveCapture, true)\n\t\tthis.addEventListener(\n\t\t\troot,\n\t\t\t'end',\n\t\t\tthis.handleTopMoveEndCapture as any,\n\t\t\ttrue,\n\t\t)\n\n\t\tif (this.options.enableMouseEvents && !this.options.ignoreContextMenu) {\n\t\t\tthis.addEventListener(\n\t\t\t\troot,\n\t\t\t\t'contextmenu',\n\t\t\t\tthis.handleTopMoveEndCapture as any,\n\t\t\t)\n\t\t}\n\n\t\tif (this.options.enableKeyboardEvents) {\n\t\t\tthis.addEventListener(\n\t\t\t\troot,\n\t\t\t\t'keydown',\n\t\t\t\tthis.handleCancelOnEscape as any,\n\t\t\t\ttrue,\n\t\t\t)\n\t\t}\n\t}\n\n\tpublic teardown(): void {\n\t\tconst root = this.options.rootElement\n\t\tif (!root) {\n\t\t\treturn\n\t\t}\n\n\t\tTouchBackendImpl.isSetUp = false\n\t\tthis._mouseClientOffset = {}\n\n\t\tthis.removeEventListener(\n\t\t\troot,\n\t\t\t'start',\n\t\t\tthis.handleTopMoveStartCapture as any,\n\t\t\ttrue,\n\t\t)\n\t\tthis.removeEventListener(root, 'start', this.handleTopMoveStart as any)\n\t\tthis.removeEventListener(root, 'move', this.handleTopMoveCapture, true)\n\t\tthis.removeEventListener(root, 'move', this.handleTopMove as any)\n\t\tthis.removeEventListener(\n\t\t\troot,\n\t\t\t'end',\n\t\t\tthis.handleTopMoveEndCapture as any,\n\t\t\ttrue,\n\t\t)\n\n\t\tif (this.options.enableMouseEvents && !this.options.ignoreContextMenu) {\n\t\t\tthis.removeEventListener(\n\t\t\t\troot,\n\t\t\t\t'contextmenu',\n\t\t\t\tthis.handleTopMoveEndCapture as any,\n\t\t\t)\n\t\t}\n\n\t\tif (this.options.enableKeyboardEvents) {\n\t\t\tthis.removeEventListener(\n\t\t\t\troot,\n\t\t\t\t'keydown',\n\t\t\t\tthis.handleCancelOnEscape as any,\n\t\t\t\ttrue,\n\t\t\t)\n\t\t}\n\n\t\tthis.uninstallSourceNodeRemovalObserver()\n\t}\n\n\tprivate addEventListener<K extends keyof EventName>(\n\t\tsubject: Node,\n\t\tevent: K,\n\t\thandler: (e: any) => void,\n\t\tcapture = false,\n\t) {\n\t\tconst options = supportsPassive ? { capture, passive: false } : capture\n\n\t\tthis.listenerTypes.forEach(function (listenerType) {\n\t\t\tconst evt = eventNames[listenerType][event]\n\n\t\t\tif (evt) {\n\t\t\t\tsubject.addEventListener(evt as any, handler as any, options)\n\t\t\t}\n\t\t})\n\t}\n\n\tprivate removeEventListener<K extends keyof EventName>(\n\t\tsubject: Node,\n\t\tevent: K,\n\t\thandler: (e: any) => void,\n\t\tcapture = false,\n\t) {\n\t\tconst options = supportsPassive ? { capture, passive: false } : capture\n\n\t\tthis.listenerTypes.forEach(function (listenerType) {\n\t\t\tconst evt = eventNames[listenerType][event]\n\n\t\t\tif (evt) {\n\t\t\t\tsubject.removeEventListener(evt as any, handler as any, options)\n\t\t\t}\n\t\t})\n\t}\n\n\tpublic connectDragSource(sourceId: string, node: HTMLElement): Unsubscribe {\n\t\tconst handleMoveStart = this.handleMoveStart.bind(this, sourceId)\n\t\tthis.sourceNodes.set(sourceId, node)\n\n\t\tthis.addEventListener(node, 'start', handleMoveStart)\n\n\t\treturn (): void => {\n\t\t\tthis.sourceNodes.delete(sourceId)\n\t\t\tthis.removeEventListener(node, 'start', handleMoveStart)\n\t\t}\n\t}\n\n\tpublic connectDragPreview(\n\t\tsourceId: string,\n\t\tnode: HTMLElement,\n\t\toptions: unknown,\n\t): Unsubscribe {\n\t\tthis.sourcePreviewNodeOptions.set(sourceId, options)\n\t\tthis.sourcePreviewNodes.set(sourceId, node)\n\n\t\treturn (): void => {\n\t\t\tthis.sourcePreviewNodes.delete(sourceId)\n\t\t\tthis.sourcePreviewNodeOptions.delete(sourceId)\n\t\t}\n\t}\n\n\tpublic connectDropTarget(targetId: string, node: HTMLElement): Unsubscribe {\n\t\tconst root = this.options.rootElement\n\t\tif (!this.document || !root) {\n\t\t\treturn (): void => {\n\t\t\t\t/* noop */\n\t\t\t}\n\t\t}\n\n\t\tconst handleMove = (e: MouseEvent | TouchEvent) => {\n\t\t\tif (!this.document || !root || !this.monitor.isDragging()) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tlet coords\n\n\t\t\t/**\n\t\t\t * Grab the coordinates for the current mouse/touch position\n\t\t\t */\n\t\t\tswitch (e.type) {\n\t\t\t\tcase eventNames.mouse.move:\n\t\t\t\t\tcoords = {\n\t\t\t\t\t\tx: (e as MouseEvent).clientX,\n\t\t\t\t\t\ty: (e as MouseEvent).clientY,\n\t\t\t\t\t}\n\t\t\t\t\tbreak\n\n\t\t\t\tcase eventNames.touch.move:\n\t\t\t\t\tcoords = {\n\t\t\t\t\t\tx: (e as TouchEvent).touches[0]?.clientX || 0,\n\t\t\t\t\t\ty: (e as TouchEvent).touches[0]?.clientY || 0,\n\t\t\t\t\t}\n\t\t\t\t\tbreak\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Use the coordinates to grab the element the drag ended on.\n\t\t\t * If the element is the same as the target node (or any of it's children) then we have hit a drop target and can handle the move.\n\t\t\t */\n\t\t\tconst droppedOn =\n\t\t\t\tcoords != null\n\t\t\t\t\t? this.document.elementFromPoint(coords.x, coords.y)\n\t\t\t\t\t: undefined\n\t\t\tconst childMatch = droppedOn && node.contains(droppedOn)\n\n\t\t\tif (droppedOn === node || childMatch) {\n\t\t\t\treturn this.handleMove(e, targetId)\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Attaching the event listener to the body so that touchmove will work while dragging over multiple target elements.\n\t\t */\n\t\tthis.addEventListener(this.document.body, 'move', handleMove as any)\n\t\tthis.targetNodes.set(targetId, node)\n\n\t\treturn (): void => {\n\t\t\tif (this.document) {\n\t\t\t\tthis.targetNodes.delete(targetId)\n\t\t\t\tthis.removeEventListener(this.document.body, 'move', handleMove as any)\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate getSourceClientOffset = (sourceId: string): XYCoord | undefined => {\n\t\tconst element = this.sourceNodes.get(sourceId)\n\t\treturn element && getNodeClientOffset(element)\n\t}\n\n\tpublic handleTopMoveStartCapture = (e: Event): void => {\n\t\tif (!eventShouldStartDrag(e as MouseEvent)) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.moveStartSourceIds = []\n\t}\n\n\tpublic handleMoveStart = (sourceId: string): void => {\n\t\t// Just because we received an event doesn't necessarily mean we need to collect drag sources.\n\t\t// We only collect start collecting drag sources on touch and left mouse events.\n\t\tif (Array.isArray(this.moveStartSourceIds)) {\n\t\t\tthis.moveStartSourceIds.unshift(sourceId)\n\t\t}\n\t}\n\n\tprivate getTopMoveStartHandler() {\n\t\tif (!this.options.delayTouchStart && !this.options.delayMouseStart) {\n\t\t\treturn this.handleTopMoveStart\n\t\t}\n\n\t\treturn this.handleTopMoveStartDelay\n\t}\n\n\tpublic handleTopMoveStart = (e: MouseEvent | TouchEvent): void => {\n\t\tif (!eventShouldStartDrag(e as MouseEvent)) {\n\t\t\treturn\n\t\t}\n\n\t\t// Don't prematurely preventDefault() here since it might:\n\t\t// 1. Mess up scrolling\n\t\t// 2. Mess up long tap (which brings up context menu)\n\t\t// 3. If there's an anchor link as a child, tap won't be triggered on link\n\n\t\tconst clientOffset = getEventClientOffset(e)\n\t\tif (clientOffset) {\n\t\t\tif (isTouchEvent(e)) {\n\t\t\t\tthis.lastTargetTouchFallback = e.targetTouches[0]\n\t\t\t}\n\t\t\tthis._mouseClientOffset = clientOffset\n\t\t}\n\t\tthis.waitingForDelay = false\n\t}\n\n\tpublic handleTopMoveStartDelay = (e: Event): void => {\n\t\tif (!eventShouldStartDrag(e as MouseEvent)) {\n\t\t\treturn\n\t\t}\n\n\t\tconst delay =\n\t\t\te.type === eventNames.touch.start\n\t\t\t\t? this.options.delayTouchStart\n\t\t\t\t: this.options.delayMouseStart\n\t\tthis.timeout = setTimeout(\n\t\t\tthis.handleTopMoveStart.bind(this, e as any),\n\t\t\tdelay,\n\t\t) as any as ReturnType<typeof setTimeout>\n\t\tthis.waitingForDelay = true\n\t}\n\n\tpublic handleTopMoveCapture = (): void => {\n\t\tthis.dragOverTargetIds = []\n\t}\n\n\tpublic handleMove = (\n\t\t_evt: MouseEvent | TouchEvent,\n\t\ttargetId: string,\n\t): void => {\n\t\tif (this.dragOverTargetIds) {\n\t\t\tthis.dragOverTargetIds.unshift(targetId)\n\t\t}\n\t}\n\n\tpublic handleTopMove = (e: TouchEvent | MouseEvent): void => {\n\t\tif (this.timeout) {\n\t\t\tclearTimeout(this.timeout)\n\t\t}\n\t\tif (!this.document || this.waitingForDelay) {\n\t\t\treturn\n\t\t}\n\t\tconst { moveStartSourceIds, dragOverTargetIds } = this\n\t\tconst enableHoverOutsideTarget = this.options.enableHoverOutsideTarget\n\n\t\tconst clientOffset = getEventClientOffset(e, this.lastTargetTouchFallback)\n\n\t\tif (!clientOffset) {\n\t\t\treturn\n\t\t}\n\n\t\t// If the touch move started as a scroll, or is is between the scroll angles\n\t\tif (\n\t\t\tthis._isScrolling ||\n\t\t\t(!this.monitor.isDragging() &&\n\t\t\t\tinAngleRanges(\n\t\t\t\t\tthis._mouseClientOffset.x || 0,\n\t\t\t\t\tthis._mouseClientOffset.y || 0,\n\t\t\t\t\tclientOffset.x,\n\t\t\t\t\tclientOffset.y,\n\t\t\t\t\tthis.options.scrollAngleRanges,\n\t\t\t\t))\n\t\t) {\n\t\t\tthis._isScrolling = true\n\t\t\treturn\n\t\t}\n\n\t\t// If we're not dragging and we've moved a little, that counts as a drag start\n\t\tif (\n\t\t\t!this.monitor.isDragging() &&\n\t\t\t// eslint-disable-next-line no-prototype-builtins\n\t\t\tthis._mouseClientOffset.hasOwnProperty('x') &&\n\t\t\tmoveStartSourceIds &&\n\t\t\tdistance(\n\t\t\t\tthis._mouseClientOffset.x || 0,\n\t\t\t\tthis._mouseClientOffset.y || 0,\n\t\t\t\tclientOffset.x,\n\t\t\t\tclientOffset.y,\n\t\t\t) > (this.options.touchSlop ? this.options.touchSlop : 0)\n\t\t) {\n\t\t\tthis.moveStartSourceIds = undefined\n\n\t\t\tthis.actions.beginDrag(moveStartSourceIds, {\n\t\t\t\tclientOffset: this._mouseClientOffset,\n\t\t\t\tgetSourceClientOffset: this.getSourceClientOffset,\n\t\t\t\tpublishSource: false,\n\t\t\t})\n\t\t}\n\n\t\tif (!this.monitor.isDragging()) {\n\t\t\treturn\n\t\t}\n\n\t\tconst sourceNode = this.sourceNodes.get(\n\t\t\tthis.monitor.getSourceId() as string,\n\t\t)\n\t\tthis.installSourceNodeRemovalObserver(sourceNode)\n\t\tthis.actions.publishDragSource()\n\n\t\tif (e.cancelable) e.preventDefault()\n\n\t\t// Get the node elements of the hovered DropTargets\n\t\tconst dragOverTargetNodes: HTMLElement[] = (dragOverTargetIds || [])\n\t\t\t.map((key) => this.targetNodes.get(key))\n\t\t\t.filter((e) => !!e) as HTMLElement[]\n\n\t\t// Get the a ordered list of nodes that are touched by\n\t\tconst elementsAtPoint = this.options.getDropTargetElementsAtPoint\n\t\t\t? this.options.getDropTargetElementsAtPoint(\n\t\t\t\t\tclientOffset.x,\n\t\t\t\t\tclientOffset.y,\n\t\t\t\t\tdragOverTargetNodes,\n\t\t\t  )\n\t\t\t: this.document.elementsFromPoint(clientOffset.x, clientOffset.y)\n\t\t// Extend list with parents that are not receiving elementsFromPoint events (size 0 elements and svg groups)\n\t\tconst elementsAtPointExtended: Element[] = []\n\t\tfor (const nodeId in elementsAtPoint) {\n\t\t\t// eslint-disable-next-line no-prototype-builtins\n\t\t\tif (!elementsAtPoint.hasOwnProperty(nodeId)) {\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tlet currentNode: Element | undefined | null = elementsAtPoint[nodeId]\n\t\t\tif (currentNode != null) {\n\t\t\t\telementsAtPointExtended.push(currentNode)\n\t\t\t}\n\t\t\twhile (currentNode) {\n\t\t\t\tcurrentNode = currentNode.parentElement\n\t\t\t\tif (\n\t\t\t\t\tcurrentNode &&\n\t\t\t\t\telementsAtPointExtended.indexOf(currentNode) === -1\n\t\t\t\t) {\n\t\t\t\t\telementsAtPointExtended.push(currentNode)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst orderedDragOverTargetIds: string[] = elementsAtPointExtended\n\t\t\t// Filter off nodes that arent a hovered DropTargets nodes\n\t\t\t.filter((node) => dragOverTargetNodes.indexOf(node as HTMLElement) > -1)\n\t\t\t// Map back the nodes elements to targetIds\n\t\t\t.map((node) => this._getDropTargetId(node))\n\t\t\t// Filter off possible null rows\n\t\t\t.filter((node) => !!node)\n\t\t\t.filter((id, index, ids) => ids.indexOf(id) === index) as string[]\n\n\t\t// Invoke hover for drop targets when source node is still over and pointer is outside\n\t\tif (enableHoverOutsideTarget) {\n\t\t\tfor (const targetId in this.targetNodes) {\n\t\t\t\tconst targetNode = this.targetNodes.get(targetId)\n\t\t\t\tif (\n\t\t\t\t\tsourceNode &&\n\t\t\t\t\ttargetNode &&\n\t\t\t\t\ttargetNode.contains(sourceNode) &&\n\t\t\t\t\torderedDragOverTargetIds.indexOf(targetId) === -1\n\t\t\t\t) {\n\t\t\t\t\torderedDragOverTargetIds.unshift(targetId)\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Reverse order because dnd-core reverse it before calling the DropTarget drop methods\n\t\torderedDragOverTargetIds.reverse()\n\n\t\tthis.actions.hover(orderedDragOverTargetIds, {\n\t\t\tclientOffset: clientOffset,\n\t\t})\n\t}\n\n\t/**\n\t *\n\t * visible for testing\n\t */\n\tpublic _getDropTargetId = (node: Element): Identifier | undefined => {\n\t\tconst keys = this.targetNodes.keys()\n\t\tlet next = keys.next()\n\t\twhile (next.done === false) {\n\t\t\tconst targetId = next.value\n\t\t\tif (node === this.targetNodes.get(targetId)) {\n\t\t\t\treturn targetId\n\t\t\t} else {\n\t\t\t\tnext = keys.next()\n\t\t\t}\n\t\t}\n\t\treturn undefined\n\t}\n\n\tpublic handleTopMoveEndCapture = (e: Event): void => {\n\t\tthis._isScrolling = false\n\t\tthis.lastTargetTouchFallback = undefined\n\n\t\tif (!eventShouldEndDrag(e as MouseEvent)) {\n\t\t\treturn\n\t\t}\n\n\t\tif (!this.monitor.isDragging() || this.monitor.didDrop()) {\n\t\t\tthis.moveStartSourceIds = undefined\n\t\t\treturn\n\t\t}\n\n\t\tif (e.cancelable) e.preventDefault()\n\n\t\tthis._mouseClientOffset = {}\n\n\t\tthis.uninstallSourceNodeRemovalObserver()\n\t\tthis.actions.drop()\n\t\tthis.actions.endDrag()\n\t}\n\n\tpublic handleCancelOnEscape = (e: KeyboardEvent): void => {\n\t\tif (e.key === 'Escape' && this.monitor.isDragging()) {\n\t\t\tthis._mouseClientOffset = {}\n\n\t\t\tthis.uninstallSourceNodeRemovalObserver()\n\t\t\tthis.actions.endDrag()\n\t\t}\n\t}\n\n\tprivate installSourceNodeRemovalObserver(node: HTMLElement | undefined) {\n\t\tthis.uninstallSourceNodeRemovalObserver()\n\n\t\tthis.draggedSourceNode = node\n\t\tthis.draggedSourceNodeRemovalObserver = new MutationObserver(() => {\n\t\t\tif (node && !node.parentElement) {\n\t\t\t\tthis.resurrectSourceNode()\n\t\t\t\tthis.uninstallSourceNodeRemovalObserver()\n\t\t\t}\n\t\t})\n\n\t\tif (!node || !node.parentElement) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.draggedSourceNodeRemovalObserver.observe(node.parentElement, {\n\t\t\tchildList: true,\n\t\t})\n\t}\n\n\tprivate resurrectSourceNode() {\n\t\tif (this.document && this.draggedSourceNode) {\n\t\t\tthis.draggedSourceNode.style.display = 'none'\n\t\t\tthis.draggedSourceNode.removeAttribute('data-reactid')\n\t\t\tthis.document.body.appendChild(this.draggedSourceNode)\n\t\t}\n\t}\n\n\tprivate uninstallSourceNodeRemovalObserver() {\n\t\tif (this.draggedSourceNodeRemovalObserver) {\n\t\t\tthis.draggedSourceNodeRemovalObserver.disconnect()\n\t\t}\n\n\t\tthis.draggedSourceNodeRemovalObserver = undefined\n\t\tthis.draggedSourceNode = undefined\n\t}\n}\n"],"names":["eventNames","ListenerType","mouse","start","move","end","contextmenu","touch","keyboard","keydown","TouchBackendImpl","profile","sourceNodes","size","sourcePreviewNodes","sourcePreviewNodeOptions","targetNodes","dragOverTargetIds","length","document","options","setup","root","rootElement","invariant","isSetUp","addEventListener","getTopMoveStartHandler","handleTopMoveStartCapture","handleTopMove","handleTopMoveCapture","handleTopMoveEndCapture","enableMouseEvents","ignoreContextMenu","enableKeyboardEvents","handleCancelOnEscape","teardown","_mouseClientOffset","removeEventListener","handleTopMoveStart","uninstallSourceNodeRemovalObserver","subject","event","handler","capture","supportsPassive","passive","listenerTypes","forEach","listenerType","evt","connectDragSource","sourceId","node","handleMoveStart","bind","set","delete","connectDragPreview","connectDropTarget","targetId","handleMove","e","monitor","isDragging","coords","type","x","clientX","y","clientY","touches","droppedOn","elementFromPoint","undefined","childMatch","contains","body","delayTouchStart","delayMouseStart","handleTopMoveStartDelay","installSourceNodeRemovalObserver","draggedSourceNode","draggedSourceNodeRemovalObserver","MutationObserver","parentElement","resurrectSourceNode","observe","childList","style","display","removeAttribute","appendChild","disconnect","manager","context","getSourceClientOffset","element","get","getNodeClientOffset","eventShouldStartDrag","moveStartSourceIds","Array","isArray","unshift","clientOffset","getEventClientOffset","isTouchEvent","lastTargetTouchFallback","targetTouches","waitingForDelay","delay","timeout","setTimeout","_evt","clearTimeout","enableHoverOutsideTarget","_isScrolling","inAngleRanges","scrollAngleRanges","hasOwnProperty","distance","touchSlop","actions","beginDrag","publishSource","sourceNode","getSourceId","publishDragSource","cancelable","preventDefault","dragOverTargetNodes","map","key","filter","elementsAtPoint","getDropTargetElementsAtPoint","elementsFromPoint","elementsAtPointExtended","nodeId","currentNode","push","indexOf","orderedDragOverTargetIds","_getDropTargetId","id","index","ids","targetNode","reverse","hover","keys","next","done","value","eventShouldEndDrag","didDrop","drop","endDrag","OptionsReader","getActions","getMonitor","Map","enableTouchEvents"],"mappings":"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"}